---
import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';
import Base from '../../layouts/Base.astro';
import { marked } from 'marked';

export async function getStaticPaths() {
  const postsDirectory = './posts';
  const postFiles = fs.readdirSync(postsDirectory).filter(f => f.endsWith('.md'));
  return postFiles.map(filename => ({ params: { slug: filename.replace(/\.md$/, '') } }));
}

const { slug } = Astro.params;
const filePath = `./posts/${slug}.md`;
const fileContent = fs.readFileSync(filePath, 'utf-8');
const { data, content } = matter(fileContent);
const html = marked(content);
---
<Base>
  <span slot="title">{data.title}</span>
  <div class="flex min-h-screen">
    <main class="flex-1 flex items-center justify-center px-8 max-md:px-2 max-md:py-8">
      <article class="w-full max-w-2xl bg-white rounded-2xl px-8 py-12 shadow border border-[#ece7e1] max-md:px-2 max-md:py-6">
        <h1 class="text-4xl font-serif font-bold mb-2">{data.title}</h1>
        <div class="text-[#b3a89c] text-sm mb-6">{data.date}</div>
        {data.image && <img src={data.image} alt="" class="mb-8 rounded-xl w-full object-cover" />}
        <div class="prose prose-lg max-w-none prose-blockquote:border-l-4 prose-blockquote:border-[#b3a89c] prose-blockquote:pl-4 prose-blockquote:italic prose-a:underline prose-a:decoration-[#b3a89c] prose-a:underline-offset-2 prose-a:font-medium prose-strong:font-semibold prose-hr:my-8 prose-img:rounded-xl prose-img:my-6 prose-img:mx-auto prose-img:w-full prose-img:max-h-[400px] prose-img:object-cover prose-p:leading-relaxed prose-p:text-[#3a3732]" set:html={html} />
      </article>
    </main>
  </div>
</Base> 